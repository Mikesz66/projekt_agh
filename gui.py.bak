import sys
import pprint
from PySide6.QtGui import Qt
from PySide6.QtWidgets import QApplication, QHBoxLayout, QLineEdit, QScrollArea, QSizePolicy, QWidget, QVBoxLayout, QPushButton, QLabel
from src.gui.custom_widgets.flow_layout import FlowScrollArea

from src.utils.bus import storage

class MainWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("PyQt6 Stylesheet Example")
        self.setGeometry(100, 100, 400, 250)
        self.setObjectName("mainWindow")

        self._ui()

    def _ui(self):
        layout = QHBoxLayout()

        # Left
        left_menu = QVBoxLayout()
        search_button = QPushButton("Search")
        search_button.clicked.connect(self.on_search_press)
        left_menu.addWidget(self._ui_app_title())
        left_menu.addWidget(self._ui_scrollable_menu())
        left_menu.addWidget(search_button)

        # Right
        right_decoration = QWidget()
        right_menu = QVBoxLayout(right_decoration)
        right_menu.addWidget(test_vertical_group())
        right_menu.addWidget(test_vertical_group())
        right_menu.addWidget(test_vertical_group())

        # Center
        layout.addLayout(left_menu)
        layout.addWidget(right_decoration)
        self.setLayout(layout)
        return

    def _ui_app_title(self) -> QWidget:
        app_title_widget = QWidget()
        app_title = QVBoxLayout(app_title_widget)
        app_title.addWidget(QLabel("Wyszukiwarka"))
        app_title.addWidget(QLabel("Przepisów"))
        app_title_widget.setSizePolicy(
            QSizePolicy.Policy.Fixed,
            QSizePolicy.Policy.Fixed
        )
        return app_title_widget

    def _ui_scrollable_menu(self) -> QScrollArea:
        content_widget = QWidget()
        filter_menu = QVBoxLayout(content_widget)

        filter_menu.addWidget(self._ui_recipe_name())
        filter_menu.addWidget(self._ui_liked_box())
        filter_menu.addWidget(self._ui_disliked_box())

        filter_menu.addStretch()

        scrollable_menu = QScrollArea()
        scrollable_menu.setWidget(content_widget)
        scrollable_menu.setWidgetResizable(True)
        scrollable_menu.setVerticalScrollBarPolicy(Qt.ScrollBarPolicy.ScrollBarAsNeeded)
        scrollable_menu.setHorizontalScrollBarPolicy(Qt.ScrollBarPolicy.ScrollBarAsNeeded)
        scrollable_menu.setSizePolicy(QSizePolicy.Policy.Preferred, QSizePolicy.Policy.Preferred)
        return scrollable_menu

    def _ui_recipe_name(self) -> QWidget:
        output_widget = QWidget()
        layout = QVBoxLayout(output_widget)
        label = QLabel("Nazwa Przepisu")
        line_edit = QLineEdit()
        storage.add("recipe_name",line_edit)

        layout.addWidget(label)
        layout.addWidget(line_edit)

        return output_widget
    def _ui_liked_box(self) -> QWidget:
        output_widget = QWidget()
        layout = QVBoxLayout(output_widget)
        label = QLabel("Składniki Lubiane")
        line_edit = QLineEdit()
        flexbox = FlowScrollArea()
        storage.add("liked_recipes",flexbox)
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))

        layout.addWidget(label)
        layout.addWidget(line_edit)
        layout.addWidget(flexbox)

        return output_widget
    def _ui_disliked_box(self) -> QWidget:
        output_widget = QWidget()
        layout = QVBoxLayout(output_widget)
        label = QLabel("Składniki Nielubiane")
        line_edit = QLineEdit()
        flexbox = FlowScrollArea()
        storage.add("disiked_recipes",flexbox)
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))
        flexbox.addWidget(QPushButton("TEST"))

        layout.addWidget(label)
        layout.addWidget(line_edit)
        layout.addWidget(flexbox)

        return output_widget

    def on_search_press(self):
        pprint.pprint(storage.get_data())

def get_stylesheet() -> str:
    try:
        with open("styles.css", "r") as f:
            stylesheet = f.read()
            return stylesheet
    except FileNotFoundError:
        print("Stylesheet 'styles.css' not found. Using default styles.")
        return ""
def test_vertical_group() -> QWidget:
    new_widget = QWidget()
    new_widget.setObjectName("test")
    return new_widget
def vertical_group() -> QWidget:
    new_widget = QWidget()
    new_widget.setObjectName("test")
    return new_widget

def main():
    app = QApplication(sys.argv)
    app.setStyleSheet(get_stylesheet())
    window = MainWindow()
    window.show()
    sys.exit(app.exec())

if __name__ == "__main__":
    main()
